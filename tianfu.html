<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>å¤©èµ‹è‡ªæµ‹ Â· å¤šå…ƒæ™ºèƒ½æ¢ç´¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }

        body {
            background-color: #f4effa;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 0;
        }

        /* å€’è®¡æ—¶æ¡æ ·å¼ */
        #timer-bar {
            width: 100%;
            background-color: #e0f2fe;
            color: #0369a1;
            padding: 10px 0;
            font-size: 14px;
            border-bottom: 2px solid #8a56d1;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
        }
        #timer-bar.hidden {
            display: none;
        }

        .app-container {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            width: 100%;
            max-width: 900px;
            margin: 20px;
            padding: 40px;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        h1 {
            font-size: 36px;
            font-weight: 700;
            color: #222222;
            text-align: center;
            margin-bottom: 24px;
        }

        .description {
            color: #444444;
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 32px;
        }

        .progress-bar-container {
            width: 100%;
            height: 12px;
            background-color: #e9e9f0;
            border-radius: 6px;
            margin-bottom: 24px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background-color: #8a56d1;
            border-radius: 6px;
            transition: width 0.3s ease;
        }

        .progress-text {
            color: #444444;
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 16px;
        }

        .question-text {
            font-size: 18px;
            font-weight: 600;
            color: #222222;
            margin-bottom: 24px;
        }

        .options-list {
            list-style: none;
            margin-bottom: 40px;
        }

        .option-item {
            border: 1px solid #e0e0e6;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #444444;
            font-size: 16px;
        }

        .option-item:hover {
            border-color: #8a56d1;
            background-color: #f9f5ff;
        }

        .option-item.selected {
            border-color: #8a56d1;
            background-color: #f9f5ff;
        }

        .button-group {
            display: flex;
            justify-content: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 32px;
            border: none;
            border-radius: 24px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background-color: #8a56d1;
            color: #ffffff;
        }

        .btn-primary:hover {
            background-color: #7644b8;
        }

        .btn-secondary {
            background-color: #ffffff;
            color: #8a56d1;
            border: 1px solid #8a56d1;
        }

        .btn-secondary:hover {
            background-color: #f9f5ff;
        }

        .btn-secondary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            border-color: #ccc;
            color: #999;
        }

        .result-header {
            font-size: 28px;
            font-weight: 700;
            color: #222222;
            text-align: center;
            margin-bottom: 24px;
        }

        .result-summary {
            color: #444444;
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 32px;
            text-align: center;
        }

        .radar-chart-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            height: 400px;
            margin: 0 auto 40px;
        }

        .radar-chart-container svg {
            width: 100%;
            height: 100%;
        }

        .talent-scores {
            margin-bottom: 40px;
        }

        .talent-item {
            display: flex;
            align-items: center;
            margin-bottom: 20px; /* å¢å¤§é—´è· */
        }

        .talent-label {
            width: 120px;
            font-size: 16px;
            color: #444444;
        }

        .talent-bar-container {
            flex: 1;
            height: 24px;
            background-color: #e9e9f0;
            border-radius: 12px;
            overflow: hidden;
            margin: 0 16px;
        }

        .talent-bar {
            height: 100%;
            background-color: #8a56d1;
            border-radius: 12px;
            transition: width 0.5s ease;
        }

        .talent-level {
            width: 180px;
            text-align: right;
            font-size: 14px;
            color: #444444;
            white-space: nowrap;
        }

        .talent-desc {
            font-size: 14px;
            color: #666;
            margin-top: 4px;
            margin-left: 136px;
            line-height: 1.5;
            margin-bottom: 24px; /* å¢åŠ æ®µè½åé—´è· */
        }

        .percentile-badge {
            background-color: #8a56d1;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-left: 8px;
            display: inline-block;
        }
    </style>
</head>
<body>
    <!-- å€’è®¡æ—¶æ¡å®¹å™¨ -->
    <div id="timer-bar" class="hidden"></div>

    <div class="app-container">
        <!-- å¼€å§‹é¡µ -->
        <div id="start-page" class="page active">
            <h1>å¤©èµ‹è‡ªæµ‹</h1>
            <div class="description">
                <p>è¯´æ˜ï¼šæ€»å…±40é¢˜ï¼Œæ¯é¢˜5ä¸ªé€‰é¡¹ã€‚è¯·æ ¹æ®æ‚¨çš„çœŸå®æ„Ÿå—é€‰æ‹©æœ€ç¬¦åˆçš„é€‰é¡¹ã€‚</p>
            </div>
            <div class="button-group">
                <button class="btn-primary" id="start-test-btn">å¼€å§‹æµ‹è¯•</button>
            </div>
        </div>

        <!-- ç­”é¢˜é¡µ -->
        <div id="quiz-page" class="page">
            <h1>å¤©èµ‹è‡ªæµ‹</h1>
            <div class="description">
                <p>è¯´æ˜ï¼šæ€»å…±40é¢˜ï¼Œæ¯é¢˜5ä¸ªé€‰é¡¹ã€‚</p>
            </div>
            <div class="progress-text" id="progress-text">1 / 40</div>
            <div class="progress-bar-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            <div class="question-text" id="question-text"></div>
            <ul class="options-list" id="options-list"></ul>
            <div class="button-group">
                <button class="btn-secondary" id="prev-btn" disabled>ä¸Šä¸€é¢˜</button>
                <button class="btn-primary" id="next-btn">ä¸‹ä¸€é¢˜</button>
            </div>
        </div>

        <!-- ç»“æœé¡µ -->
        <div id="result-page" class="page">
            <h1 class="result-header">æ­å–œå®Œæˆæµ‹è¯•</h1>
            <p class="result-summary" id="result-summary"></p>
            <h2 style="font-size: 24px; margin-bottom: 24px;">å¤©èµ‹èƒ½åŠ›å›¾</h2>
            <div class="radar-chart-container" id="radar-chart">
                <svg viewBox="0 0 400 400">
                    <!-- èƒŒæ™¯ç½‘æ ¼å°†ç”±JSåŠ¨æ€ç»˜åˆ¶ï¼Œä»¥å…è¦†ç›– -->
                    <g id="radar-background"></g>
                    <polygon id="radar-polygon" fill="rgba(138,86,209,0.2)" stroke="#8a56d1" stroke-width="2" />
                    <g id="radar-labels"></g>
                </svg>
            </div>
            <h2 style="font-size: 24px; margin-bottom: 24px;">å„é¡¹å¤©èµ‹åˆ†å€¼</h2>
            <div class="talent-scores" id="talent-scores"></div>
            <div class="button-group">
                <button class="btn-primary" id="restart-btn">é‡æ–°æµ‹è¯•</button>
            </div>
        </div>
    </div>

    <script>
        // ---------- è¿‡æœŸéªŒè¯è„šæœ¬ (æ”¾åœ¨æœ€é¡¶éƒ¨æ‰§è¡Œ) ----------
        (function() {
            const timerBar = document.getElementById('timer-bar');
            const urlParams = new URLSearchParams(window.location.search);
            const expire = urlParams.get('expire');

            if (!expire) {
                document.body.innerHTML = '<div style="text-align:center; margin-top:50px; font-family: sans-serif; color:#8a56d1; font-size:20px;">ğŸ”’ æ— æ•ˆçš„è®¿é—®é“¾æ¥</div>';
                window.stop();
                return;
            }

            const now = Math.floor(Date.now() / 1000);
            const expireTime = parseInt(expire, 10);

            if (isNaN(expireTime) || expireTime <= 0) {
                document.body.innerHTML = '<div style="text-align:center; margin-top:50px; font-family: sans-serif; color:#8a56d1; font-size:20px;">âš ï¸ é“¾æ¥æ ¼å¼é”™è¯¯</div>';
                window.stop();
                return;
            }

            if (now > expireTime) {
                document.body.innerHTML = '<div style="text-align:center; margin-top:50px; font-family: sans-serif; color:#8a56d1; font-size:20px;">â³ æ­¤é“¾æ¥å·²è¿‡æœŸï¼Œè¯·é‡æ–°è´­ä¹°</div>';
                window.stop();
                return;
            }

            timerBar.classList.remove('hidden');

            function updateTimer() {
                const now = Math.floor(Date.now() / 1000);
                const remaining = expireTime - now;
                if (remaining <= 0) {
                    document.body.innerHTML = '<div style="text-align:center; margin-top:50px; font-family: sans-serif; color:#8a56d1; font-size:20px;">â³ æ­¤é“¾æ¥å·²è¿‡æœŸï¼Œè¯·é‡æ–°è´­ä¹°</div>';
                    window.stop();
                    return;
                }
                const minutes = Math.floor(remaining / 60);
                const seconds = remaining % 60;
                timerBar.innerHTML = `â° æœ¬é“¾æ¥å‰©ä½™æœ‰æ•ˆæ—¶é—´ï¼š${minutes}åˆ†${seconds}ç§’ï¼ˆè¿‡æœŸåé“¾æ¥å°†è‡ªåŠ¨å¤±æ•ˆï¼‰`;
            }

            updateTimer();
            setInterval(updateTimer, 1000);
        })();

        // ---------- é¢˜ç›®æ•°æ® ----------
        const questions = [
            // è¯­è¨€ (A)
            { id: 1, text: "æˆ‘æ“…é•¿ç”¨æˆ‘çš„è¯­è¨€è¯´æœå¯¹æ–¹", category: "A" },
            { id: 2, text: "æˆ‘èƒ½æ¸…æ™°æµç•…åœ°è¡¨è¾¾å¤æ‚æƒ³æ³•", category: "A" },
            { id: 3, text: "æˆ‘å–„äºç”¨æ–‡å­—æ‰“åŠ¨ä»–äºº", category: "A" },
            { id: 4, text: "æˆ‘å–œæ¬¢å†™ä½œå¹¶äº«å—ç”¨è¯é€ å¥", category: "A" },
            // é€»è¾‘-ç®—æ•° (B)
            { id: 5, text: "æˆ‘æ“…é•¿è§£å†³é€»è¾‘è°œé¢˜", category: "B" },
            { id: 6, text: "æˆ‘èƒ½å¿«é€Ÿè¿›è¡Œå¿ƒç®—", category: "B" },
            { id: 7, text: "æˆ‘å–œæ¬¢åˆ†ææ•°æ®å’Œå‘ç°è§„å¾‹", category: "B" },
            { id: 8, text: "æˆ‘å–„äºç”¨æ¨ç†è§£å†³é—®é¢˜", category: "B" },
            // ç©ºé—´ (C)
            { id: 9, text: "æˆ‘æ“…é•¿åœ¨è„‘æµ·ä¸­æ—‹è½¬ä¸‰ç»´ç‰©ä½“", category: "C" },
            { id: 10, text: "æˆ‘èƒ½è½»æ¾çœ‹æ‡‚åœ°å›¾å’Œå›¾è¡¨", category: "C" },
            { id: 11, text: "æˆ‘å–„äºæƒ³è±¡ç‰©ä½“ä¸åŒè§’åº¦çš„æ ·å­", category: "C" },
            { id: 12, text: "æˆ‘å–œæ¬¢è®¾è®¡æˆ–æ­å»ºä¸œè¥¿", category: "C" },
            // å†…çœ (D)
            { id: 13, text: "æˆ‘æ“…é•¿è¯†åˆ«å’Œç†è§£è‡ªå·±çš„æƒ…ç»ª", category: "D" },
            { id: 14, text: "æˆ‘æ¸…æ¥šè‡ªå·±çš„ä¼˜ç‚¹å’Œç¼ºç‚¹", category: "D" },
            { id: 15, text: "æˆ‘ç»å¸¸åæ€è‡ªå·±çš„è¡Œä¸ºå’ŒåŠ¨æœº", category: "D" },
            { id: 16, text: "æˆ‘èƒ½å¤Ÿå¾ˆå¥½åœ°è‡ªæˆ‘æ¿€åŠ±", category: "D" },
            // äººé™… (E)
            { id: 17, text: "æˆ‘å–„äºç†è§£ä»–äººçš„æ„Ÿå—", category: "E" },
            { id: 18, text: "æˆ‘èƒ½è½»æ¾ä¸é™Œç”Ÿäººå»ºç«‹è”ç³»", category: "E" },
            { id: 19, text: "æˆ‘æ“…é•¿è°ƒè§£å†²çª", category: "E" },
            { id: 20, text: "æˆ‘å–œæ¬¢å›¢é˜Ÿåˆä½œå¹¶å‘æŒ¥æ¯ä¸ªäººçš„é•¿å¤„", category: "E" },
            // èº«ä½“-åŠ¨è§‰ (F)
            { id: 21, text: "æˆ‘æ“…é•¿éœ€è¦æ‰‹çœ¼åè°ƒçš„ä»»åŠ¡", category: "F" },
            { id: 22, text: "æˆ‘æ“…é•¿æµç•…å‡†ç¡®åœ°å®Œæˆä¸€ç³»åˆ—åŠ¨ä½œ", category: "F" },
            { id: 23, text: "æˆ‘å­¦è·³èˆæˆ–è¿åŠ¨å¾ˆå¿«", category: "F" },
            { id: 24, text: "æˆ‘å–œæ¬¢åŠ¨æ‰‹åˆ¶ä½œä¸œè¥¿", category: "F" },
            // éŸ³ä¹ (G)
            { id: 25, text: "æˆ‘æ“…é•¿è·ŸéšéŸ³ä¹çš„èŠ‚æ‹", category: "G" },
            { id: 26, text: "æˆ‘èƒ½è¾¨åˆ«éŸ³é«˜å’Œæ—‹å¾‹", category: "G" },
            { id: 27, text: "æˆ‘ç»å¸¸åœ¨è„‘æµ·ä¸­å›å“éŸ³ä¹", category: "G" },
            { id: 28, text: "æˆ‘å–œæ¬¢åˆ›ä½œæˆ–æ”¹ç¼–éŸ³ä¹", category: "G" },
            // è‡ªç„¶ (H)
            { id: 29, text: "æˆ‘æ“…é•¿åˆ¤æ–­åŠ¨ç‰©çš„éœ€æ±‚", category: "H" },
            { id: 30, text: "æˆ‘èƒ½è®°ä½ä¸åŒæ¤ç‰©çš„åç§°å’Œç‰¹å¾", category: "H" },
            { id: 31, text: "æˆ‘å–œæ¬¢è§‚å¯Ÿè‡ªç„¶ç°è±¡", category: "H" },
            { id: 32, text: "æˆ‘å–„äºç…§é¡¾æ¤ç‰©æˆ–å® ç‰©", category: "H" },
            // åˆ›é€  (I)
            { id: 33, text: "æˆ‘ç»å¸¸äº§ç”Ÿæ–°é¢–çš„æƒ³æ³•", category: "I" },
            { id: 34, text: "æˆ‘å–„äºä»ä¸åŒè§’åº¦çœ‹é—®é¢˜", category: "I" },
            { id: 35, text: "æˆ‘å–œæ¬¢å°è¯•æ–°æ–¹æ³•è§£å†³é—®é¢˜", category: "I" },
            { id: 36, text: "æˆ‘æœ‰ä¸°å¯Œçš„æƒ³è±¡åŠ›", category: "I" },
            // ç¾å­¦ (J)
            { id: 37, text: "æˆ‘å¯¹ç¾çš„äº‹ç‰©æœ‰å¼ºçƒˆæ„Ÿå—", category: "J" },
            { id: 38, text: "æˆ‘èƒ½æ¬£èµä¸åŒé£æ ¼çš„è‰ºæœ¯ä½œå“", category: "J" },
            { id: 39, text: "æˆ‘å–„äºå¸ƒç½®ç¯å¢ƒä½¿å…¶å’Œè°", category: "J" },
            { id: 40, text: "æˆ‘ç»å¸¸è¢«è‡ªç„¶æˆ–äººé€ çš„ç¾æ™¯æ‰“åŠ¨", category: "J" }
        ];

        const options = ["éå¸¸ç¬¦åˆ", "å¾ˆç¬¦åˆ", "éƒ¨åˆ†ç¬¦åˆ", "ä¸å¤ªç¬¦åˆ", "å®Œå…¨ä¸ç¬¦åˆ"];
        const optionScores = [5, 4, 3, 2, 1]; // 5ç‚¹é‡è¡¨æ­£å‘è®¡åˆ†

        // ç»´åº¦å®šä¹‰ï¼ˆæ±‰å­—æ ‡ç­¾ç”¨äºé›·è¾¾å›¾ï¼‰
        const talentCategories = {
            A: { name: "è¯­è¨€", maxScore: 20, desc: "è¯­è¨€å¤©èµ‹æŒ‡è¿ç”¨å£å¤´å’Œä¹¦é¢è¯­è¨€çš„èƒ½åŠ›ï¼Œæ“…é•¿è¡¨è¾¾ã€è¯´æœå’Œå†™ä½œã€‚" },
            B: { name: "é€»è¾‘", maxScore: 20, desc: "é€»è¾‘-ç®—æ•°å¤©èµ‹æŒ‡å¤„ç†æ•°å­—ã€è¯†åˆ«æ¨¡å¼å’Œè¿›è¡Œé€»è¾‘æ¨ç†çš„èƒ½åŠ›ã€‚" },
            C: { name: "ç©ºé—´", maxScore: 20, desc: "ç©ºé—´å¤©èµ‹æŒ‡åœ¨è„‘æµ·ä¸­æƒ³è±¡å’Œæ“ä½œç©ºé—´å…³ç³»çš„èƒ½åŠ›ï¼Œå¦‚è®¾è®¡ã€å¯¼èˆªã€‚" },
            D: { name: "å†…çœ", maxScore: 20, desc: "å†…çœå¤©èµ‹æŒ‡æ·±å…¥ç†è§£è‡ªå·±çš„æƒ…æ„Ÿã€åŠ¨æœºå’Œå†…å¿ƒä¸–ç•Œçš„èƒ½åŠ›ã€‚" },
            E: { name: "äººé™…", maxScore: 20, desc: "äººé™…å¤©èµ‹æŒ‡ç†è§£ä»–äººã€ä¸ä»–äººæœ‰æ•ˆåˆä½œå’Œè§£å†³å†²çªçš„èƒ½åŠ›ã€‚" },
            F: { name: "èº«ä½“", maxScore: 20, desc: "èº«ä½“-åŠ¨è§‰å¤©èµ‹æŒ‡ç”¨èº«ä½“è¡¨è¾¾æƒ³æ³•æˆ–æŠ€èƒ½çš„èƒ½åŠ›ï¼Œå¦‚è¿åŠ¨ã€èˆè¹ˆã€æ‰‹å·¥ã€‚" },
            G: { name: "éŸ³ä¹", maxScore: 20, desc: "éŸ³ä¹å¤©èµ‹æŒ‡æ„ŸçŸ¥ã€è¾¨åˆ«å’Œè¡¨è¾¾éŸ³ä¹å…ƒç´ ï¼ˆå¦‚éŸ³é«˜ã€èŠ‚å¥ï¼‰çš„èƒ½åŠ›ã€‚" },
            H: { name: "è‡ªç„¶", maxScore: 20, desc: "è‡ªç„¶å¤©èµ‹æŒ‡è¯†åˆ«å’Œåˆ†ç±»è‡ªç„¶ç•Œç‰©ç§ï¼ˆåŠ¨æ¤ç‰©ã€çŸ¿ç‰©ï¼‰çš„èƒ½åŠ›ã€‚" },
            I: { name: "åˆ›é€ ", maxScore: 20, desc: "åˆ›é€ å¤©èµ‹æŒ‡äº§ç”Ÿæ–°é¢–æƒ³æ³•ã€çªç ´å¸¸è§„æ€ç»´çš„èƒ½åŠ›ã€‚" },
            J: { name: "ç¾å­¦", maxScore: 20, desc: "ç¾å­¦å¤©èµ‹æŒ‡å¯¹ç¾çš„æ•æ„Ÿå’Œåˆ›é€ ç¾çš„èƒ½åŠ›ï¼ŒåŒ…æ‹¬è‰ºæœ¯é‰´èµå’Œè®¾è®¡ã€‚" }
        };

        // çŠ¶æ€å˜é‡
        let currentQuestionIndex = 0;
        let answers = {};

        // DOM å…ƒç´ 
        const startPage = document.getElementById("start-page");
        const quizPage = document.getElementById("quiz-page");
        const resultPage = document.getElementById("result-page");
        const startTestBtn = document.getElementById("start-test-btn");
        const prevBtn = document.getElementById("prev-btn");
        const nextBtn = document.getElementById("next-btn");
        const restartBtn = document.getElementById("restart-btn");
        const progressText = document.getElementById("progress-text");
        const progressBar = document.getElementById("progress-bar");
        const questionText = document.getElementById("question-text");
        const optionsList = document.getElementById("options-list");
        const resultSummary = document.getElementById("result-summary");
        const talentScoresContainer = document.getElementById("talent-scores");
        const radarBackground = document.getElementById("radar-background");
        const radarPolygon = document.getElementById("radar-polygon");
        const radarLabels = document.getElementById("radar-labels");

        // åŠ è½½/ä¿å­˜ç­”æ¡ˆ
        function loadAnswers() {
            const saved = localStorage.getItem("talentTestAnswers");
            if (saved) {
                try {
                    answers = JSON.parse(saved);
                } catch (e) {
                    answers = {};
                }
            } else {
                answers = {};
            }
        }
        function saveAnswers() {
            localStorage.setItem("talentTestAnswers", JSON.stringify(answers));
        }

        // å¼€å§‹æµ‹è¯•
        function startTest() {
            loadAnswers();
            currentQuestionIndex = 0;
            startPage.classList.remove("active");
            quizPage.classList.add("active");
            renderQuestion();
        }

        function renderQuestion() {
            const question = questions[currentQuestionIndex];
            progressText.textContent = `${currentQuestionIndex + 1} / ${questions.length}`;
            progressBar.style.width = `${((currentQuestionIndex + 1) / questions.length) * 100}%`;
            questionText.textContent = question.text;
            optionsList.innerHTML = "";

            options.forEach((option, idx) => {
                const li = document.createElement("li");
                li.className = "option-item";
                li.textContent = option;
                li.addEventListener("click", () => selectOption(idx));
                if (answers[question.id] === idx) {
                    li.classList.add("selected");
                }
                optionsList.appendChild(li);
            });

            prevBtn.disabled = currentQuestionIndex === 0;
            nextBtn.textContent = currentQuestionIndex === questions.length - 1 ? "å®Œæˆ" : "ä¸‹ä¸€é¢˜";
        }

        function selectOption(optionIndex) {
            const question = questions[currentQuestionIndex];
            answers[question.id] = optionIndex;
            saveAnswers();
            // æ›´æ–°é«˜äº®
            const items = optionsList.querySelectorAll(".option-item");
            items.forEach((item, idx) => {
                if (idx === optionIndex) item.classList.add("selected");
                else item.classList.remove("selected");
            });
            // è‡ªåŠ¨è·³è½¬
            if (currentQuestionIndex < questions.length - 1) {
                goToNextQuestion();
            } else {
                calculateResults();
                showResults();
            }
        }

        function goToPrevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderQuestion();
            }
        }

        function goToNextQuestion() {
            const question = questions[currentQuestionIndex];
            if (answers[question.id] === undefined) {
                alert("è¯·å…ˆé€‰æ‹©å½“å‰é¢˜ç›®çš„é€‰é¡¹");
                return;
            }
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                renderQuestion();
            } else {
                calculateResults();
                showResults();
            }
        }

        // è®¡ç®—åˆ†æ•°å’Œå¸¸æ¨¡ç™¾åˆ†ä½
        function calculateResults() {
            const scores = {};
            for (let key in talentCategories) scores[key] = 0;

            questions.forEach(q => {
                const ansIdx = answers[q.id];
                if (ansIdx !== undefined) {
                    scores[q.category] += optionScores[ansIdx];
                }
            });

            function percentile(score) {
                if (score < 8) return 10;
                if (score < 12) return 30;
                if (score < 15) return 60;
                if (score < 18) return 85;
                return 98;
            }

            const results = {};
            for (let key in talentCategories) {
                const raw = scores[key];
                results[key] = {
                    raw: raw,
                    percentile: percentile(raw),
                    level: raw >= 16 ? "éå¸¸æ“…é•¿" : raw >= 12 ? "æ“…é•¿" : raw >= 8 ? "ä¸€èˆ¬" : "ä¸æ“…é•¿"
                };
            }
            return results;
        }

        // ç»˜åˆ¶é›·è¾¾å›¾èƒŒæ™¯ç½‘æ ¼
        function drawRadarBackground(keys, maxScore = 20) {
            const centerX = 200, centerY = 200, radius = 150;
            const numAxes = keys.length;
            const angleStep = (2 * Math.PI) / numAxes;

            let bgHtml = '';

            // ç»˜åˆ¶ä»ä¸­å¿ƒåˆ°é¡¶ç‚¹çš„è½´çº¿ï¼ˆç°è‰²ï¼‰
            for (let i = 0; i < numAxes; i++) {
                const angle = -Math.PI / 2 + i * angleStep;
                const x = centerX + radius * Math.cos(angle);
                const y = centerY + radius * Math.sin(angle);
                bgHtml += `<line x1="${centerX}" y1="${centerY}" x2="${x}" y2="${y}" stroke="#ccc" stroke-width="1" stroke-dasharray="4,4" />`;
            }

            // ç»˜åˆ¶åŒå¿ƒå¤šè¾¹å½¢ (20%, 40%, 60%, 80%, 100%)
            for (let level = 0.2; level <= 1; level += 0.2) {
                const points = [];
                for (let i = 0; i < numAxes; i++) {
                    const angle = -Math.PI / 2 + i * angleStep;
                    const x = centerX + radius * level * Math.cos(angle);
                    const y = centerY + radius * level * Math.sin(angle);
                    points.push(`${x},${y}`);
                }
                bgHtml += `<polygon points="${points.join(' ')}" fill="none" stroke="#ddd" stroke-width="1" stroke-dasharray="2,2" />`;
            }

            radarBackground.innerHTML = bgHtml;
        }

        // ç»˜åˆ¶é›·è¾¾å›¾æ•°æ®åŠæ ‡ç­¾
        function drawRadarChart(results) {
            const centerX = 200, centerY = 200, radius = 150;
            const keys = Object.keys(talentCategories);
            const numAxes = keys.length;
            const angleStep = (2 * Math.PI) / numAxes;

            // ç»˜åˆ¶èƒŒæ™¯ç½‘æ ¼ï¼ˆå…ˆæ¸…é™¤å†ç”»ï¼‰
            drawRadarBackground(keys);

            // æ•°æ®å¤šè¾¹å½¢
            const points = [];
            keys.forEach((key, i) => {
                const angle = -Math.PI / 2 + i * angleStep;
                const scoreRatio = results[key].raw / talentCategories[key].maxScore;
                const x = centerX + radius * scoreRatio * Math.cos(angle);
                const y = centerY + radius * scoreRatio * Math.sin(angle);
                points.push(`${x},${y}`);
            });
            radarPolygon.setAttribute("points", points.join(" "));

            // æ¸…é™¤æ—§æ ‡ç­¾
            radarLabels.innerHTML = "";

            // æ·»åŠ æ±‰å­—æ ‡ç­¾
            keys.forEach((key, i) => {
                const angle = -Math.PI / 2 + i * angleStep;
                const x = centerX + (radius + 25) * Math.cos(angle);
                const y = centerY + (radius + 25) * Math.sin(angle);
                const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                text.setAttribute("x", x);
                text.setAttribute("y", y);
                text.setAttribute("text-anchor", "middle");
                text.setAttribute("dominant-baseline", "middle");
                text.setAttribute("fill", "#8a56d1");
                text.setAttribute("font-size", "12");
                text.textContent = talentCategories[key].name; // æ±‰å­—
                radarLabels.appendChild(text);
            });
        }

        // æ˜¾ç¤ºç»“æœ
        function showResults() {
            const results = calculateResults();
            quizPage.classList.remove("active");
            resultPage.classList.add("active");

            // æ€»ç»“è¯­
            const sorted = Object.entries(results).sort((a, b) => b[1].raw - a[1].raw);
            const top3 = sorted.slice(0, 3).map(item => talentCategories[item[0]].name);
            const bottom3 = sorted.slice(-3).map(item => talentCategories[item[0]].name);
            resultSummary.textContent = `ä½ æœ€å…·æœ‰ ${top3.join("ã€")} å¤©èµ‹ï¼Œè€Œ ${bottom3.join("ã€")} å¤©èµ‹ç›¸å¯¹è¾ƒå¼±ã€‚`;

            // æ¸²æŸ“åˆ†æ•°æ¡
            talentScoresContainer.innerHTML = "";
            for (let [key, value] of Object.entries(talentCategories)) {
                const score = results[key].raw;
                const percent = results[key].percentile;
                const level = results[key].level;
                const widthPercent = (score / value.maxScore) * 100;

                const div = document.createElement("div");
                div.className = "talent-item";
                div.innerHTML = `
                    <div class="talent-label">${value.name}</div>
                    <div class="talent-bar-container">
                        <div class="talent-bar" style="width: ${widthPercent}%"></div>
                    </div>
                    <div class="talent-level">${score}åˆ†  <span class="percentile-badge">é«˜äº${percent}%ç”¨æˆ·</span></div>
                `;
                talentScoresContainer.appendChild(div);

                const descDiv = document.createElement("div");
                descDiv.className = "talent-desc";
                descDiv.innerHTML = `<strong>${value.name}ï¼š</strong>${value.desc} ${level}ï¼Œé«˜äº${percent}%çš„å‚ä¸è€…ã€‚`;
                talentScoresContainer.appendChild(descDiv);
            }

            drawRadarChart(results);
        }

        // é‡æ–°æµ‹è¯•
        function restartTest() {
            localStorage.removeItem("talentTestAnswers");
            answers = {};
            resultPage.classList.remove("active");
            startPage.classList.add("active");
        }

        // ç»‘å®šäº‹ä»¶
        startTestBtn.addEventListener("click", startTest);
        prevBtn.addEventListener("click", goToPrevQuestion);
        nextBtn.addEventListener("click", goToNextQuestion);
        restartBtn.addEventListener("click", restartTest);
    </script>
</body>
</html>